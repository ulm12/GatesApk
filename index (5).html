<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login Gate</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
  <div class="bg-white p-8 rounded-lg shadow-lg max-w-md w-full">
    <h2 class="text-2xl font-bold mb-6 text-center text-gray-800">Login</h2>

    <!-- Form login -->
    <form id="loginForm" class="space-y-4">
      <div>
        <label for="user" class="block text-sm font-medium text-gray-700">User</label>
        <input type="text" id="user" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="Enter your user">
      </div>
      <div>
        <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
        <input type="password" id="password" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="Enter your password">
      </div>
      <button type="submit" class="w-full bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">Login</button>
    </form>

    <!-- Area pesan error -->
    <p id="errorMessage" class="mt-4 text-red-500 text-center hidden"></p>
  </div>

  <script>
    const SHEET_ID = "1QAUpeAhyQ5_stuGHWnQwbQeH69TRyIEAFQHxYJERE3k";
    const API_KEY = "AIzaSyBvQjvYoT3ylrTtJvA7bK0ecwm6rUJqhec";

    const CREDENTIALS_URL = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/Users!A:B?key=${API_KEY}`;
    const REDIRECT_URL = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/Channels.Accounts!D:E?key=${API_KEY}`;

    const form = document.getElementById("loginForm");
    const errorMessage = document.getElementById("errorMessage");

    function showError(message) {
      errorMessage.textContent = message;
      errorMessage.classList.remove("hidden");
    }

    function hideError() {
      errorMessage.classList.add("hidden");
    }

    async function fetchSheetData(url) {
      const res = await fetch(url);
      if (!res.ok) throw new Error(`Gagal mengambil data: ${res.statusText}`);
      const data = await res.json();
      return data.values ? data.values.slice(1) : [];
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      hideError();

      const username = document.getElementById("user").value.trim();
      const password = document.getElementById("password").value.trim();

      if (!username || !password) {
        showError("Please enter both user and password.");
        return;
      }

      try {
        // Ambil credentials
        const users = await fetchSheetData(CREDENTIALS_URL);

        // Validasi login
        const validUser = users.find(row => row[0] === username && row[1] === password);
        if (!validUser) {
          showError("Invalid user or password.");
          return;
        }

        // Ambil data redirect
        const redirects = await fetchSheetData(REDIRECT_URL);
        const redirectRow = redirects.find(row => row[0] === username);

        if (redirectRow && redirectRow[1]) {
          window.location.href = redirectRow[1];
        } else {
          showError("No redirect URL found for this user.");
        }

      } catch (err) {
        showError(err.message || "An unexpected error occurred.");
      }
    });
  </script>
</body>
</html>
